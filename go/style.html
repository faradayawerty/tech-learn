<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>style</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<!--

Editing this document:

- Discuss all changes in GitHub issues first.
- Update the table of contents as new sections are added or removed.
- Use tables for side-by-side code samples. See below.

Code Samples:

Use 2 spaces to indent. Horizontal real estate is important in side-by-side
samples.

For side-by-side code samples, use the following snippet.

~~~
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
BAD CODE GOES HERE
```

</td><td>

```go
GOOD CODE GOES HERE
```

</td></tr>
</tbody></table>
~~~

(You need the empty lines between the <td> and code samples for it to be
treated as Markdown.)

If you need to add labels or descriptions below the code samples, add another
row before the </tbody></table> line.

~~~
<tr>
<td>DESCRIBE BAD CODE</td>
<td>DESCRIBE GOOD CODE</td>
</tr>
~~~

-->
<h1 id="uber-go-style-guide">Uber Go Style Guide</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#guidelines">Guidelines</a>
<ul>
<li><a href="#pointers-to-interfaces">Pointers to Interfaces</a></li>
<li><a href="#verify-interface-compliance">Verify Interface Compliance</a></li>
<li><a href="#receivers-and-interfaces">Receivers and Interfaces</a></li>
<li><a href="#zero-value-mutexes-are-valid">Zero-value Mutexes are Valid</a></li>
<li><a href="#copy-slices-and-maps-at-boundaries">Copy Slices and Maps at Boundaries</a></li>
<li><a href="#defer-to-clean-up">Defer to Clean Up</a></li>
<li><a href="#channel-size-is-one-or-none">Channel Size is One or None</a></li>
<li><a href="#start-enums-at-one">Start Enums at One</a></li>
<li><a href="#use-time-to-handle-time">Use <code>"time"</code> to handle time</a></li>
<li><a href="#error-types">Error Types</a></li>
<li><a href="#error-wrapping">Error Wrapping</a></li>
<li><a href="#handle-type-assertion-failures">Handle Type Assertion Failures</a></li>
<li><a href="#dont-panic">Don’t Panic</a></li>
<li><a href="#use-gouberorgatomic">Use go.uber.org/atomic</a></li>
<li><a href="#avoid-mutable-globals">Avoid Mutable Globals</a></li>
<li><a href="#avoid-embedding-types-in-public-structs">Avoid Embedding Types in Public Structs</a></li>
<li><a href="#avoid-using-built-in-names">Avoid Using Built-In Names</a></li>
<li><a href="#avoid-init">Avoid <code>init()</code></a></li>
<li><a href="#exit-in-main">Exit in Main</a>
<ul>
<li><a href="#exit-once">Exit Once</a></li>
</ul></li>
</ul></li>
<li><a href="#performance">Performance</a>
<ul>
<li><a href="#prefer-strconv-over-fmt">Prefer strconv over fmt</a></li>
<li><a href="#avoid-string-to-byte-conversion">Avoid string-to-byte conversion</a></li>
<li><a href="#prefer-specifying-container-capacity">Prefer Specifying Container Capacity</a>
<ul>
<li><a href="#specifying-map-capacity-hints">Specifying Map Capacity Hints</a></li>
<li><a href="#specifying-slice-capacity">Specifying Slice Capacity</a></li>
</ul></li>
</ul></li>
<li><a href="#style">Style</a>
<ul>
<li><a href="#be-consistent">Be Consistent</a></li>
<li><a href="#group-similar-declarations">Group Similar Declarations</a></li>
<li><a href="#import-group-ordering">Import Group Ordering</a></li>
<li><a href="#package-names">Package Names</a></li>
<li><a href="#function-names">Function Names</a></li>
<li><a href="#import-aliasing">Import Aliasing</a></li>
<li><a href="#function-grouping-and-ordering">Function Grouping and Ordering</a></li>
<li><a href="#reduce-nesting">Reduce Nesting</a></li>
<li><a href="#unnecessary-else">Unnecessary Else</a></li>
<li><a href="#top-level-variable-declarations">Top-level Variable Declarations</a></li>
<li><a href="#prefix-unexported-globals-with-_">Prefix Unexported Globals with _</a></li>
<li><a href="#embedding-in-structs">Embedding in Structs</a></li>
<li><a href="#local-variable-declarations">Local Variable Declarations</a></li>
<li><a href="#nil-is-a-valid-slice">nil is a valid slice</a></li>
<li><a href="#reduce-scope-of-variables">Reduce Scope of Variables</a></li>
<li><a href="#avoid-naked-parameters">Avoid Naked Parameters</a></li>
<li><a href="#use-raw-string-literals-to-avoid-escaping">Use Raw String Literals to Avoid Escaping</a></li>
<li><a href="#initializing-structs">Initializing Structs</a>
<ul>
<li><a href="#use-field-names-to-initialize-structs">Use Field Names to Initialize Structs</a></li>
<li><a href="#omit-zero-value-fields-in-structs">Omit Zero Value Fields in Structs</a></li>
<li><a href="#use-var-for-zero-value-structs">Use <code>var</code> for Zero Value Structs</a></li>
<li><a href="#initializing-struct-references">Initializing Struct References</a></li>
</ul></li>
<li><a href="#initializing-maps">Initializing Maps</a></li>
<li><a href="#format-strings-outside-printf">Format Strings outside Printf</a></li>
<li><a href="#naming-printf-style-functions">Naming Printf-style Functions</a></li>
</ul></li>
<li><a href="#patterns">Patterns</a>
<ul>
<li><a href="#test-tables">Test Tables</a></li>
<li><a href="#functional-options">Functional Options</a></li>
</ul></li>
<li><a href="#linting">Linting</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>Styles are the conventions that govern our code. The term style is a bit of a misnomer, since these conventions cover far more than just source file formatting—gofmt handles that for us.</p>
<p>The goal of this guide is to manage this complexity by describing in detail the Dos and Don’ts of writing Go code at Uber. These rules exist to keep the code base manageable while still allowing engineers to use Go language features productively.</p>
<p>This guide was originally created by <a href="https://github.com/prashantv">Prashant Varanasi</a> and <a href="https://github.com/nomis52">Simon Newton</a> as a way to bring some colleagues up to speed with using Go. Over the years it has been amended based on feedback from others.</p>
<p>This documents idiomatic conventions in Go code that we follow at Uber. A lot of these are general guidelines for Go, while others extend upon external resources:</p>
<ol type="1">
<li><a href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
<li><a href="https://github.com/golang/go/wiki/CommonMistakes">Go Common Mistakes</a></li>
<li><a href="https://github.com/golang/go/wiki/CodeReviewComments">Go Code Review Comments</a></li>
</ol>
<p>All code should be error-free when run through <code>golint</code> and <code>go vet</code>. We recommend setting up your editor to:</p>
<ul>
<li>Run <code>goimports</code> on save</li>
<li>Run <code>golint</code> and <code>go vet</code> to check for errors</li>
</ul>
<p>You can find information in editor support for Go tools here: <a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins" class="uri">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p>
<h2 id="guidelines">Guidelines</h2>
<h3 id="pointers-to-interfaces">Pointers to Interfaces</h3>
<p>You almost never need a pointer to an interface. You should be passing interfaces as values—the underlying data can still be a pointer.</p>
<p>An interface is two fields:</p>
<ol type="1">
<li>A pointer to some type-specific information. You can think of this as “type.”</li>
<li>Data pointer. If the data stored is a pointer, it’s stored directly. If the data stored is a value, then a pointer to the value is stored.</li>
</ol>
<p>If you want interface methods to modify the underlying data, you must use a pointer.</p>
<h3 id="verify-interface-compliance">Verify Interface Compliance</h3>
<p>Verify interface compliance at compile time where appropriate. This includes:</p>
<ul>
<li>Exported types that are required to implement specific interfaces as part of their API contract</li>
<li>Exported or unexported types that are part of a collection of types implementing the same interface</li>
<li>Other cases where violating an interface would break users</li>
</ul>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Handler <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>h <span class="op">*</span>Handler<span class="op">)</span> ServeHTTP<span class="op">(</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  w http<span class="op">.</span>ResponseWriter<span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Handler <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _ http<span class="op">.</span>Handler <span class="op">=</span> <span class="op">(*</span>Handler<span class="op">)(</span><span class="ot">nil</span><span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>h <span class="op">*</span>Handler<span class="op">)</span> ServeHTTP<span class="op">(</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  w http<span class="op">.</span>ResponseWriter<span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>The statement <code>var _ http.Handler = (*Handler)(nil)</code> will fail to compile if <code>*Handler</code> ever stops matching the <code>http.Handler</code> interface.</p>
<p>The right hand side of the assignment should be the zero value of the asserted type. This is <code>nil</code> for pointer types (like <code>*Handler</code>), slices, and maps, and an empty struct for struct types.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> LogHandler <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  h   http<span class="op">.</span>Handler</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  log <span class="op">*</span>zap<span class="op">.</span>Logger</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _ http<span class="op">.</span>Handler <span class="op">=</span> LogHandler<span class="op">{}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>h LogHandler<span class="op">)</span> ServeHTTP<span class="op">(</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  w http<span class="op">.</span>ResponseWriter<span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="receivers-and-interfaces">Receivers and Interfaces</h3>
<p>Methods with value receivers can be called on pointers as well as values. Methods with pointer receivers can only be called on pointers or <a href="https://golang.org/ref/spec#Method_values">addressable values</a>.</p>
<p>For example,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> S <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  data <span class="dt">string</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s S<span class="op">)</span> Read<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> s<span class="op">.</span>data</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>S<span class="op">)</span> Write<span class="op">(</span>str <span class="dt">string</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span>data <span class="op">=</span> str</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>sVals <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">int</span><span class="op">]</span>S<span class="op">{</span><span class="dv">1</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;A&quot;</span><span class="op">}}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">// You can only call Read using a value</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>sVals<span class="op">[</span><span class="dv">1</span><span class="op">].</span>Read<span class="op">()</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">// This will not compile:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">//  sVals[1].Write(&quot;test&quot;)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>sPtrs <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">int</span><span class="op">]*</span>S<span class="op">{</span><span class="dv">1</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;A&quot;</span><span class="op">}}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">// You can call both Read and Write using a pointer</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>sPtrs<span class="op">[</span><span class="dv">1</span><span class="op">].</span>Read<span class="op">()</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>sPtrs<span class="op">[</span><span class="dv">1</span><span class="op">].</span>Write<span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, an interface can be satisfied by a pointer, even if the method has a value receiver.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> F <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  f<span class="op">()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> S1 <span class="kw">struct</span><span class="op">{}</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s S1<span class="op">)</span> f<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> S2 <span class="kw">struct</span><span class="op">{}</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>S2<span class="op">)</span> f<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>s1Val <span class="op">:=</span> S1<span class="op">{}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>s1Ptr <span class="op">:=</span> <span class="op">&amp;</span>S1<span class="op">{}</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>s2Val <span class="op">:=</span> S2<span class="op">{}</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>s2Ptr <span class="op">:=</span> <span class="op">&amp;</span>S2<span class="op">{}</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> i F</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> s1Val</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> s1Ptr</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> s2Ptr</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">// The following doesn&#39;t compile, since s2Val is a value, and there is no value receiver for f.</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">//   i = s2Val</span></span></code></pre></div>
<p>Effective Go has a good write up on <a href="https://golang.org/doc/effective_go.html#pointers_vs_values">Pointers vs. Values</a>.</p>
<h3 id="zero-value-mutexes-are-valid">Zero-value Mutexes are Valid</h3>
<p>The zero-value of <code>sync.Mutex</code> and <code>sync.RWMutex</code> is valid, so you almost never need a pointer to a mutex.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mu <span class="op">:=</span> <span class="bu">new</span><span class="op">(</span>sync<span class="op">.</span>Mutex<span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mu<span class="op">.</span>Lock<span class="op">()</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mu sync<span class="op">.</span>Mutex</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mu<span class="op">.</span>Lock<span class="op">()</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>If you use a struct by pointer, then the mutex should be a non-pointer field on it. Do not embed the mutex on the struct, even if the struct is not exported.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb8"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> SMap <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  sync<span class="op">.</span>Mutex</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  data <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">string</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> NewSMap<span class="op">()</span> <span class="op">*</span>SMap <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="op">&amp;</span>SMap<span class="op">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">string</span><span class="op">),</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>m <span class="op">*</span>SMap<span class="op">)</span> Get<span class="op">(</span>k <span class="dt">string</span><span class="op">)</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  m<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> m<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> m<span class="op">.</span>data<span class="op">[</span>k<span class="op">]</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> SMap <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  mu sync<span class="op">.</span>Mutex</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  data <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">string</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> NewSMap<span class="op">()</span> <span class="op">*</span>SMap <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="op">&amp;</span>SMap<span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">string</span><span class="op">),</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>m <span class="op">*</span>SMap<span class="op">)</span> Get<span class="op">(</span>k <span class="dt">string</span><span class="op">)</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  m<span class="op">.</span>mu<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> m<span class="op">.</span>mu<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> m<span class="op">.</span>data<span class="op">[</span>k<span class="op">]</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<p>The <code>Mutex</code> field, and the <code>Lock</code> and <code>Unlock</code> methods are unintentionally part of the exported API of <code>SMap</code>.</p>
</td>
<td>
<p>The mutex and its methods are implementation details of <code>SMap</code> hidden from its callers.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="copy-slices-and-maps-at-boundaries">Copy Slices and Maps at Boundaries</h3>
<p>Slices and maps contain pointers to the underlying data so be wary of scenarios when they need to be copied.</p>
<h4 id="receiving-slices-and-maps">Receiving Slices and Maps</h4>
<p>Keep in mind that users can modify a map or slice you received as an argument if you store a reference to it.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb10"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>d <span class="op">*</span>Driver<span class="op">)</span> SetTrips<span class="op">(</span>trips <span class="op">[]</span>Trip<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  d<span class="op">.</span>trips <span class="op">=</span> trips</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>trips <span class="op">:=</span> <span class="op">...</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>d1<span class="op">.</span>SetTrips<span class="op">(</span>trips<span class="op">)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Did you mean to modify d1.trips?</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>trips<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">...</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb11"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>d <span class="op">*</span>Driver<span class="op">)</span> SetTrips<span class="op">(</span>trips <span class="op">[]</span>Trip<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  d<span class="op">.</span>trips <span class="op">=</span> <span class="bu">make</span><span class="op">([]</span>Trip<span class="op">,</span> <span class="bu">len</span><span class="op">(</span>trips<span class="op">))</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">copy</span><span class="op">(</span>d<span class="op">.</span>trips<span class="op">,</span> trips<span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>trips <span class="op">:=</span> <span class="op">...</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>d1<span class="op">.</span>SetTrips<span class="op">(</span>trips<span class="op">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">// We can now modify trips[0] without affecting d1.trips.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>trips<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">...</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h4 id="returning-slices-and-maps">Returning Slices and Maps</h4>
<p>Similarly, be wary of user modifications to maps or slices exposing internal state.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb12"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Stats <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  mu sync<span class="op">.</span>Mutex</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  counters <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">int</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Snapshot returns the current stats.</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>Stats<span class="op">)</span> Snapshot<span class="op">()</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">int</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span>mu<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> s<span class="op">.</span>mu<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> s<span class="op">.</span>counters</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">// snapshot is no longer protected by the mutex, so any</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">// access to the snapshot is subject to data races.</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>snapshot <span class="op">:=</span> stats<span class="op">.</span>Snapshot<span class="op">()</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb13"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Stats <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  mu sync<span class="op">.</span>Mutex</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  counters <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">int</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>Stats<span class="op">)</span> Snapshot<span class="op">()</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">int</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span>mu<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> s<span class="op">.</span>mu<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  result <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="dt">int</span><span class="op">,</span> <span class="bu">len</span><span class="op">(</span>s<span class="op">.</span>counters<span class="op">))</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> k<span class="op">,</span> v <span class="op">:=</span> <span class="kw">range</span> s<span class="op">.</span>counters <span class="op">{</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    result<span class="op">[</span>k<span class="op">]</span> <span class="op">=</span> v</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> result</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Snapshot is now a copy.</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>snapshot <span class="op">:=</span> stats<span class="op">.</span>Snapshot<span class="op">()</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="defer-to-clean-up">Defer to Clean Up</h3>
<p>Use defer to clean up resources such as files and locks.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb14"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> p<span class="op">.</span>count <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  p<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> p<span class="op">.</span>count</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>count<span class="op">++</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>newCount <span class="op">:=</span> p<span class="op">.</span>count</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span> newCount</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">// easy to miss unlocks due to multiple returns</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb15"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>Lock<span class="op">()</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defer</span> p<span class="op">.</span>Unlock<span class="op">()</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> p<span class="op">.</span>count <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">{</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> p<span class="op">.</span>count</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>count<span class="op">++</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span> p<span class="op">.</span>count</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">// more readable</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Defer has an extremely small overhead and should be avoided only if you can prove that your function execution time is in the order of nanoseconds. The readability win of using defers is worth the miniscule cost of using them. This is especially true for larger methods that have more than simple memory accesses, where the other computations are more significant than the <code>defer</code>.</p>
<h3 id="channel-size-is-one-or-none">Channel Size is One or None</h3>
<p>Channels should usually have a size of one or be unbuffered. By default, channels are unbuffered and have a size of zero. Any other size must be subject to a high level of scrutiny. Consider how the size is determined, what prevents the channel from filling up under load and blocking writers, and what happens when this occurs.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb16"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Ought to be enough for anybody!</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>c <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">chan</span> <span class="dt">int</span><span class="op">,</span> <span class="dv">64</span><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb17"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Size of one</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>c <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">chan</span> <span class="dt">int</span><span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="co">// or</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Unbuffered channel, size of zero</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">chan</span> <span class="dt">int</span><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="start-enums-at-one">Start Enums at One</h3>
<p>The standard way of introducing enumerations in Go is to declare a custom type and a <code>const</code> group with <code>iota</code>. Since variables have a 0 default value, you should usually start your enums on a non-zero value.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb18"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Operation <span class="dt">int</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  Add Operation <span class="op">=</span> <span class="ot">iota</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  Subtract</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  Multiply</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Add=0, Subtract=1, Multiply=2</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb19"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Operation <span class="dt">int</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  Add Operation <span class="op">=</span> <span class="ot">iota</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  Subtract</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  Multiply</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Add=1, Subtract=2, Multiply=3</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>There are cases where using the zero value makes sense, for example when the zero value case is the desirable default behavior.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> LogOutput <span class="dt">int</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  LogToStdout LogOutput <span class="op">=</span> <span class="ot">iota</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  LogToFile</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  LogToRemote</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">// LogToStdout=0, LogToFile=1, LogToRemote=2</span></span></code></pre></div>
<h3 id="use-time-to-handle-time">Use <code>"time"</code> to handle time</h3>
<p>Time is complicated. Incorrect assumptions often made about time include the following.</p>
<ol type="1">
<li>A day has 24 hours</li>
<li>An hour has 60 minutes</li>
<li>A week has 7 days</li>
<li>A year has 365 days</li>
<li><a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">And a lot more</a></li>
</ol>
<p>For example, <em>1</em> means that adding 24 hours to a time instant will not always yield a new calendar day.</p>
<p>Therefore, always use the <a href="https://golang.org/pkg/time/"><code>"time"</code></a> package when dealing with time because it helps deal with these incorrect assumptions in a safer, more accurate manner.</p>
<h4 id="use-time.time-for-instants-of-time">Use <code>time.Time</code> for instants of time</h4>
<p>Use <a href="https://golang.org/pkg/time/#Time"><code>time.Time</code></a> when dealing with instants of time, and the methods on <code>time.Time</code> when comparing, adding, or subtracting time.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb21"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> isActive<span class="op">(</span>now<span class="op">,</span> start<span class="op">,</span> stop <span class="dt">int</span><span class="op">)</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> start <span class="op">&lt;=</span> now <span class="op">&amp;&amp;</span> now <span class="op">&lt;</span> stop</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb22"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> isActive<span class="op">(</span>now<span class="op">,</span> start<span class="op">,</span> stop time<span class="op">.</span>Time<span class="op">)</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="op">(</span>start<span class="op">.</span>Before<span class="op">(</span>now<span class="op">)</span> <span class="op">||</span> start<span class="op">.</span>Equal<span class="op">(</span>now<span class="op">))</span> <span class="op">&amp;&amp;</span> now<span class="op">.</span>Before<span class="op">(</span>stop<span class="op">)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h4 id="use-time.duration-for-periods-of-time">Use <code>time.Duration</code> for periods of time</h4>
<p>Use <a href="https://golang.org/pkg/time/#Duration"><code>time.Duration</code></a> when dealing with periods of time.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb23"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> poll<span class="op">(</span>delay <span class="dt">int</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="op">{</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    time<span class="op">.</span>Sleep<span class="op">(</span>time<span class="op">.</span>Duration<span class="op">(</span>delay<span class="op">)</span> <span class="op">*</span> time<span class="op">.</span>Millisecond<span class="op">)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>poll<span class="op">(</span><span class="dv">10</span><span class="op">)</span> <span class="co">// was it seconds or milliseconds?</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb24"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> poll<span class="op">(</span>delay time<span class="op">.</span>Duration<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="op">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    time<span class="op">.</span>Sleep<span class="op">(</span>delay<span class="op">)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>poll<span class="op">(</span><span class="dv">10</span><span class="op">*</span>time<span class="op">.</span>Second<span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Going back to the example of adding 24 hours to a time instant, the method we use to add time depends on intent. If we want the same time of the day, but on the next calendar day, we should use <a href="https://golang.org/pkg/time/#Time.AddDate"><code>Time.AddDate</code></a>. However, if we want an instant of time guaranteed to be 24 hours after the previous time, we should use <a href="https://golang.org/pkg/time/#Time.Add"><code>Time.Add</code></a>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>newDay <span class="op">:=</span> t<span class="op">.</span>AddDate<span class="op">(</span><span class="dv">0</span> <span class="co">/* years */</span><span class="op">,</span> <span class="dv">0</span> <span class="co">/* months */</span><span class="op">,</span> <span class="dv">1</span> <span class="co">/* days */</span><span class="op">)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>maybeNewDay <span class="op">:=</span> t<span class="op">.</span>Add<span class="op">(</span><span class="dv">24</span> <span class="op">*</span> time<span class="op">.</span>Hour<span class="op">)</span></span></code></pre></div>
<h4 id="use-time.time-and-time.duration-with-external-systems">Use <code>time.Time</code> and <code>time.Duration</code> with external systems</h4>
<p>Use <code>time.Duration</code> and <code>time.Time</code> in interactions with external systems when possible. For example:</p>
<ul>
<li>Command-line flags: <a href="https://golang.org/pkg/flag/"><code>flag</code></a> supports <code>time.Duration</code> via <a href="https://golang.org/pkg/time/#ParseDuration"><code>time.ParseDuration</code></a></li>
<li>JSON: <a href="https://golang.org/pkg/encoding/json/"><code>encoding/json</code></a> supports encoding <code>time.Time</code> as an <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> string via its <a href="https://golang.org/pkg/time/#Time.UnmarshalJSON"><code>UnmarshalJSON</code> method</a></li>
<li>SQL: <a href="https://golang.org/pkg/database/sql/"><code>database/sql</code></a> supports converting <code>DATETIME</code> or <code>TIMESTAMP</code> columns into <code>time.Time</code> and back if the underlying driver supports it</li>
<li>YAML: <a href="https://godoc.org/gopkg.in/yaml.v2"><code>gopkg.in/yaml.v2</code></a> supports <code>time.Time</code> as an <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> string, and <code>time.Duration</code> via <a href="https://golang.org/pkg/time/#ParseDuration"><code>time.ParseDuration</code></a>.</li>
</ul>
<p>When it is not possible to use <code>time.Duration</code> in these interactions, use <code>int</code> or <code>float64</code> and include the unit in the name of the field.</p>
<p>For example, since <code>encoding/json</code> does not support <code>time.Duration</code>, the unit is included in the name of the field.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb26"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// {&quot;interval&quot;: 2}</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Config <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  Interval <span class="dt">int</span> <span class="st">`json:&quot;interval&quot;`</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb27"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// {&quot;intervalMillis&quot;: 2000}</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Config <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  IntervalMillis <span class="dt">int</span> <span class="st">`json:&quot;intervalMillis&quot;`</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>When it is not possible to use <code>time.Time</code> in these interactions, unless an alternative is agreed upon, use <code>string</code> and format timestamps as defined in <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a>. This format is used by default by <a href="https://golang.org/pkg/time/#Time.UnmarshalText"><code>Time.UnmarshalText</code></a> and is available for use in <code>Time.Format</code> and <code>time.Parse</code> via <a href="https://golang.org/pkg/time/#RFC3339"><code>time.RFC3339</code></a>.</p>
<p>Although this tends to not be a problem in practice, keep in mind that the <code>"time"</code> package does not support parsing timestamps with leap seconds (<a href="https://github.com/golang/go/issues/8728">8728</a>), nor does it account for leap seconds in calculations (<a href="https://github.com/golang/go/issues/15190">15190</a>). If you compare two instants of time, the difference will not include the leap seconds that may have occurred between those two instants.</p>
<!-- TODO: section on String methods for enums -->
<h3 id="error-types">Error Types</h3>
<p>There are various options for declaring errors:</p>
<ul>
<li><a href="https://golang.org/pkg/errors/#New"><code>errors.New</code></a> for errors with simple static strings</li>
<li><a href="https://golang.org/pkg/fmt/#Errorf"><code>fmt.Errorf</code></a> for formatted error strings</li>
<li>Custom types that implement an <code>Error()</code> method</li>
<li>Wrapped errors using <a href="https://godoc.org/github.com/pkg/errors#Wrap"><code>"pkg/errors".Wrap</code></a></li>
</ul>
<p>When returning errors, consider the following to determine the best choice:</p>
<ul>
<li>Is this a simple error that needs no extra information? If so, <a href="https://golang.org/pkg/errors/#New"><code>errors.New</code></a> should suffice.</li>
<li>Do the clients need to detect and handle this error? If so, you should use a custom type, and implement the <code>Error()</code> method.</li>
<li>Are you propagating an error returned by a downstream function? If so, check the <a href="#error-wrapping">section on error wrapping</a>.</li>
<li>Otherwise, <a href="https://golang.org/pkg/fmt/#Errorf"><code>fmt.Errorf</code></a> is okay.</li>
</ul>
<p>If the client needs to detect the error, and you have created a simple error using <a href="https://golang.org/pkg/errors/#New"><code>errors.New</code></a>, use a var for the error.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb28"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// package foo</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">()</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> errors<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;could not open&quot;</span><span class="op">)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">// package bar</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> use<span class="op">()</span> <span class="op">{</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> foo<span class="op">.</span>Open<span class="op">();</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> err<span class="op">.</span>Error<span class="op">()</span> <span class="op">==</span> <span class="st">&quot;could not open&quot;</span> <span class="op">{</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// handle</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;unknown error&quot;</span><span class="op">)</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb29"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// package foo</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ErrCouldNotOpen <span class="op">=</span> errors<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;could not open&quot;</span><span class="op">)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">()</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> ErrCouldNotOpen</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">// package bar</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">:=</span> foo<span class="op">.</span>Open<span class="op">();</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> errors<span class="op">.</span>Is<span class="op">(</span>err<span class="op">,</span> foo<span class="op">.</span>ErrCouldNotOpen<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;unknown error&quot;</span><span class="op">)</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>If you have an error that clients may need to detect, and you would like to add more information to it (e.g., it is not a static string), then you should use a custom type.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb30"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> open<span class="op">(</span>file <span class="dt">string</span><span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> fmt<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;file %q not found&quot;</span><span class="op">,</span> file<span class="op">)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> use<span class="op">()</span> <span class="op">{</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> open<span class="op">(</span><span class="st">&quot;testfile.txt&quot;</span><span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> strings<span class="op">.</span>Contains<span class="op">(</span>err<span class="op">.</span>Error<span class="op">(),</span> <span class="st">&quot;not found&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// handle</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>      <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;unknown error&quot;</span><span class="op">)</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb31"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> errNotFound <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  file <span class="dt">string</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>e errNotFound<span class="op">)</span> Error<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;file %q not found&quot;</span><span class="op">,</span> e<span class="op">.</span>file<span class="op">)</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> open<span class="op">(</span>file <span class="dt">string</span><span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> errNotFound<span class="op">{</span>file<span class="op">:</span> file<span class="op">}</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> use<span class="op">()</span> <span class="op">{</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> open<span class="op">(</span><span class="st">&quot;testfile.txt&quot;</span><span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> _<span class="op">,</span> ok <span class="op">:=</span> err<span class="op">.(</span>errNotFound<span class="op">);</span> ok <span class="op">{</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// handle</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>      <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;unknown error&quot;</span><span class="op">)</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Be careful with exporting custom error types directly since they become part of the public API of the package. It is preferable to expose matcher functions to check the error instead.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// package foo</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> errNotFound <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  file <span class="dt">string</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>e errNotFound<span class="op">)</span> Error<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;file %q not found&quot;</span><span class="op">,</span> e<span class="op">.</span>file<span class="op">)</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> IsNotFoundError<span class="op">(</span>err <span class="dt">error</span><span class="op">)</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  _<span class="op">,</span> ok <span class="op">:=</span> err<span class="op">.(</span>errNotFound<span class="op">)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> ok</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">(</span>file <span class="dt">string</span><span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> errNotFound<span class="op">{</span>file<span class="op">:</span> file<span class="op">}</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">// package bar</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">:=</span> foo<span class="op">.</span>Open<span class="op">(</span><span class="st">&quot;foo&quot;</span><span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> foo<span class="op">.</span>IsNotFoundError<span class="op">(</span>err<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;unknown error&quot;</span><span class="op">)</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<!-- TODO: Exposing the information to callers with accessor functions. -->
<h3 id="error-wrapping">Error Wrapping</h3>
<p>There are three main options for propagating errors if a call fails:</p>
<ul>
<li>Return the original error if there is no additional context to add and you want to maintain the original error type.</li>
<li>Add context using <a href="https://godoc.org/github.com/pkg/errors#Wrap"><code>"pkg/errors".Wrap</code></a> so that the error message provides more context and <a href="https://godoc.org/github.com/pkg/errors#Cause"><code>"pkg/errors".Cause</code></a> can be used to extract the original error.</li>
<li>Use <a href="https://golang.org/pkg/fmt/#Errorf"><code>fmt.Errorf</code></a> if the callers do not need to detect or handle that specific error case.</li>
</ul>
<p>It is recommended to add context where possible so that instead of a vague error such as “connection refused”, you get more useful errors such as “call service foo: connection refused”.</p>
<p>When adding context to returned errors, keep the context succinct by avoiding phrases like “failed to”, which state the obvious and pile up as the error percolates up through the stack:</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb33"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">,</span> err <span class="op">:=</span> store<span class="op">.</span>New<span class="op">()</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> fmt<span class="op">.</span>Errorf<span class="op">(</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;failed to create new store: %v&quot;</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb34"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">,</span> err <span class="op">:=</span> store<span class="op">.</span>New<span class="op">()</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> fmt<span class="op">.</span>Errorf<span class="op">(</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;new store: %v&quot;</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<tr>
<td>
<pre><code>failed to x: failed to y: failed to create new store: the error</code></pre>
</td>
<td>
<pre><code>x: y: new store: the error</code></pre>
</td>
</tr>
</tbody>
</table>
<p>However once the error is sent to another system, it should be clear the message is an error (e.g. an <code>err</code> tag or “Failed” prefix in logs).</p>
<p>See also <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Don’t just check errors, handle them gracefully</a>.</p>
<h3 id="handle-type-assertion-failures">Handle Type Assertion Failures</h3>
<p>The single return value form of a <a href="https://golang.org/ref/spec#Type_assertions">type assertion</a> will panic on an incorrect type. Therefore, always use the “comma ok” idiom.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb37"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">:=</span> i<span class="op">.(</span><span class="dt">string</span><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb38"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>t<span class="op">,</span> ok <span class="op">:=</span> i<span class="op">.(</span><span class="dt">string</span><span class="op">)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">!</span>ok <span class="op">{</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// handle the error gracefully</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<!-- TODO: There are a few situations where the single assignment form is
fine. -->
<h3 id="dont-panic">Don’t Panic</h3>
<p>Code running in production must avoid panics. Panics are a major source of <a href="https://en.wikipedia.org/wiki/Cascading_failure">cascading failures</a>. If an error occurs, the function must return an error and allow the caller to decide how to handle it.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb39"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> run<span class="op">(</span>args <span class="op">[]</span><span class="dt">string</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="bu">len</span><span class="op">(</span>args<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;an argument is required&quot;</span><span class="op">)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  run<span class="op">(</span>os<span class="op">.</span>Args<span class="op">[</span><span class="dv">1</span><span class="op">:])</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb40"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> run<span class="op">(</span>args <span class="op">[]</span><span class="dt">string</span><span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="bu">len</span><span class="op">(</span>args<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> errors<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;an argument is required&quot;</span><span class="op">)</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="ot">nil</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> run<span class="op">(</span>os<span class="op">.</span>Args<span class="op">[</span><span class="dv">1</span><span class="op">:]);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Fprintln<span class="op">(</span>os<span class="op">.</span>Stderr<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    os<span class="op">.</span>Exit<span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Panic/recover is not an error handling strategy. A program must panic only when something irrecoverable happens such as a nil dereference. An exception to this is program initialization: bad things at program startup that should abort the program may cause panic.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _statusTemplate <span class="op">=</span> template<span class="op">.</span>Must<span class="op">(</span>template<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;name&quot;</span><span class="op">).</span>Parse<span class="op">(</span><span class="st">&quot;_statusHTML&quot;</span><span class="op">))</span></span></code></pre></div>
<p>Even in tests, prefer <code>t.Fatal</code> or <code>t.FailNow</code> over panics to ensure that the test is marked as failed.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb42"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func TestFoo(t *testing.T)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>f<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>TempFile<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;failed to set up test&quot;</span><span class="op">)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb43"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func TestFoo(t *testing.T)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>f<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>TempFile<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  t<span class="op">.</span>Fatal<span class="op">(</span><span class="st">&quot;failed to set up test&quot;</span><span class="op">)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<!-- TODO: Explain how to use _test packages. -->
<h3 id="use-go.uber.orgatomic">Use go.uber.org/atomic</h3>
<p>Atomic operations with the <a href="https://golang.org/pkg/sync/atomic/">sync/atomic</a> package operate on the raw types (<code>int32</code>, <code>int64</code>, etc.) so it is easy to forget to use the atomic operation to read or modify the variables.</p>
<p><a href="https://godoc.org/go.uber.org/atomic">go.uber.org/atomic</a> adds type safety to these operations by hiding the underlying type. Additionally, it includes a convenient <code>atomic.Bool</code> type.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb44"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> foo <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  running <span class="dt">int32</span>  <span class="co">// atomic</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f<span class="op">*</span> foo<span class="op">)</span> start<span class="op">()</span> <span class="op">{</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> atomic<span class="op">.</span>SwapInt32<span class="op">(&amp;</span>f<span class="op">.</span>running<span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">==</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>     <span class="co">// already running…</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">return</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// start the Foo</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f <span class="op">*</span>foo<span class="op">)</span> isRunning<span class="op">()</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> f<span class="op">.</span>running <span class="op">==</span> <span class="dv">1</span>  <span class="co">// race!</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb45"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> foo <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  running atomic<span class="op">.</span>Bool</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f <span class="op">*</span>foo<span class="op">)</span> start<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> f<span class="op">.</span>running<span class="op">.</span>Swap<span class="op">(</span><span class="ot">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>     <span class="co">// already running…</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">return</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// start the Foo</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f <span class="op">*</span>foo<span class="op">)</span> isRunning<span class="op">()</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> f<span class="op">.</span>running<span class="op">.</span>Load<span class="op">()</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="avoid-mutable-globals">Avoid Mutable Globals</h3>
<p>Avoid mutating global variables, instead opting for dependency injection. This applies to function pointers as well as other kinds of values.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb46"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sign.go</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _timeNow <span class="op">=</span> time<span class="op">.</span>Now</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> sign<span class="op">(</span>msg <span class="dt">string</span><span class="op">)</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  now <span class="op">:=</span> _timeNow<span class="op">()</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> signWithTime<span class="op">(</span>msg<span class="op">,</span> now<span class="op">)</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb47"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sign.go</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> signer <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  now <span class="kw">func</span><span class="op">()</span> time<span class="op">.</span>Time</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> newSigner<span class="op">()</span> <span class="op">*</span>signer <span class="op">{</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="op">&amp;</span>signer<span class="op">{</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    now<span class="op">:</span> time<span class="op">.</span>Now<span class="op">,</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>signer<span class="op">)</span> Sign<span class="op">(</span>msg <span class="dt">string</span><span class="op">)</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  now <span class="op">:=</span> s<span class="op">.</span>now<span class="op">()</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> signWithTime<span class="op">(</span>msg<span class="op">,</span> now<span class="op">)</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<div class="sourceCode" id="cb48"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sign_test.go</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestSign<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  oldTimeNow <span class="op">:=</span> _timeNow</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  _timeNow <span class="op">=</span> <span class="kw">func</span><span class="op">()</span> time<span class="op">.</span>Time <span class="op">{</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> someFixedTime</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> <span class="kw">func</span><span class="op">()</span> <span class="op">{</span> _timeNow <span class="op">=</span> oldTimeNow <span class="op">}()</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> want<span class="op">,</span> sign<span class="op">(</span>give<span class="op">))</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb49"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sign_test.go</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestSigner<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  s <span class="op">:=</span> newSigner<span class="op">()</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span>now <span class="op">=</span> <span class="kw">func</span><span class="op">()</span> time<span class="op">.</span>Time <span class="op">{</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> someFixedTime</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> want<span class="op">,</span> s<span class="op">.</span>Sign<span class="op">(</span>give<span class="op">))</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="avoid-embedding-types-in-public-structs">Avoid Embedding Types in Public Structs</h3>
<p>These embedded types leak implementation details, inhibit type evolution, and obscure documentation.</p>
<p>Assuming you have implemented a variety of list types using a shared <code>AbstractList</code>, avoid embedding the <code>AbstractList</code> in your concrete list implementations. Instead, hand-write only the methods to your concrete list that will delegate to the abstract list.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> AbstractList <span class="kw">struct</span> <span class="op">{}</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Add adds an entity to the list.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>AbstractList<span class="op">)</span> Add<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove removes an entity from the list.</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>AbstractList<span class="op">)</span> Remove<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb51"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ConcreteList is a list of entities.</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ConcreteList <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">*</span>AbstractList</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb52"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ConcreteList is a list of entities.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ConcreteList <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  list <span class="op">*</span>AbstractList</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Add adds an entity to the list.</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>ConcreteList<span class="op">)</span> Add<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  l<span class="op">.</span>list<span class="op">.</span>Add<span class="op">(</span>e<span class="op">)</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove removes an entity from the list.</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>ConcreteList<span class="op">)</span> Remove<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  l<span class="op">.</span>list<span class="op">.</span>Remove<span class="op">(</span>e<span class="op">)</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Go allows <a href="https://golang.org/doc/effective_go.html#embedding">type embedding</a> as a compromise between inheritance and composition. The outer type gets implicit copies of the embedded type’s methods. These methods, by default, delegate to the same method of the embedded instance.</p>
<p>The struct also gains a field by the same name as the type. So, if the embedded type is public, the field is public. To maintain backward compatibility, every future version of the outer type must keep the embedded type.</p>
<p>An embedded type is rarely necessary. It is a convenience that helps you avoid writing tedious delegate methods.</p>
<p>Even embedding a compatible AbstractList <em>interface</em>, instead of the struct, would offer the developer more flexibility to change in the future, but still leak the detail that the concrete lists use an abstract implementation.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb53"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">// AbstractList is a generalized implementation</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">// for various kinds of lists of entities.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> AbstractList <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  Add<span class="op">(</span>Entity<span class="op">)</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  Remove<span class="op">(</span>Entity<span class="op">)</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ConcreteList is a list of entities.</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ConcreteList <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  AbstractList</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb54"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ConcreteList is a list of entities.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ConcreteList <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  list AbstractList</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Add adds an entity to the list.</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>ConcreteList<span class="op">)</span> Add<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  l<span class="op">.</span>list<span class="op">.</span>Add<span class="op">(</span>e<span class="op">)</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove removes an entity from the list.</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l <span class="op">*</span>ConcreteList<span class="op">)</span> Remove<span class="op">(</span>e Entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  l<span class="op">.</span>list<span class="op">.</span>Remove<span class="op">(</span>e<span class="op">)</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Either with an embedded struct or an embedded interface, the embedded type places limits on the evolution of the type.</p>
<ul>
<li>Adding methods to an embedded interface is a breaking change.</li>
<li>Removing methods from an embedded struct is a breaking change.</li>
<li>Removing the embedded type is a breaking change.</li>
<li>Replacing the embedded type, even with an alternative that satisfies the same interface, is a breaking change.</li>
</ul>
<p>Although writing these delegate methods is tedious, the additional effort hides an implementation detail, leaves more opportunities for change, and also eliminates indirection for discovering the full List interface in documentation.</p>
<h3 id="avoid-using-built-in-names">Avoid Using Built-In Names</h3>
<p>The Go <a href="https://golang.org/ref/spec">language specification</a> outlines several built-in, <a href="https://golang.org/ref/spec#Predeclared_identifiers">predeclared identifiers</a> that should not be used as names within Go programs.</p>
<p>Depending on context, reusing these identifiers as names will either shadow the original within the current lexical scope (and any nested scopes) or make affected code confusing. In the best case, the compiler will complain; in the worst case, such code may introduce latent, hard-to-grep bugs.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb55"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="dt">error</span> <span class="dt">string</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">// `error` shadows the builtin</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">// or</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handleErrorMessage<span class="op">(</span><span class="dt">error</span> <span class="dt">string</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `error` shadows the builtin</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb56"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> errorMessage <span class="dt">string</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">// `error` refers to the builtin</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">// or</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handleErrorMessage<span class="op">(</span>msg <span class="dt">string</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `error` refers to the builtin</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<div class="sourceCode" id="cb57"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Foo <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// While these fields technically don&#39;t</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// constitute shadowing, grepping for</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `error` or `string` strings is now</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ambiguous.</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">error</span>  <span class="dt">error</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> <span class="dt">string</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f Foo<span class="op">)</span> Error<span class="op">()</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `error` and `f.error` are</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// visually similar</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> f<span class="op">.</span><span class="dt">error</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f Foo<span class="op">)</span> String<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `string` and `f.string` are</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// visually similar</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> f<span class="op">.</span><span class="dt">string</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb58"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Foo <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `error` and `string` strings are</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// now unambiguous.</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    err <span class="dt">error</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    str <span class="dt">string</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f Foo<span class="op">)</span> Error<span class="op">()</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> f<span class="op">.</span>err</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f Foo<span class="op">)</span> String<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> f<span class="op">.</span>str</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Note that the compiler will not generate errors when using predeclared identifiers, but tools such as <code>go vet</code> should correctly point out these and other cases of shadowing.</p>
<h3 id="avoid-init">Avoid <code>init()</code></h3>
<p>Avoid <code>init()</code> where possible. When <code>init()</code> is unavoidable or desirable, code should attempt to:</p>
<ol type="1">
<li>Be completely deterministic, regardless of program environment or invocation.</li>
<li>Avoid depending on the ordering or side-effects of other <code>init()</code> functions. While <code>init()</code> ordering is well-known, code can change, and thus relationships between <code>init()</code> functions can make code brittle and error-prone.</li>
<li>Avoid accessing or manipulating global or environment state, such as machine information, environment variables, working directory, program arguments/inputs, etc.</li>
<li>Avoid I/O, including both filesystem, network, and system calls.</li>
</ol>
<p>Code that cannot satisfy these requirements likely belongs as a helper to be called as part of <code>main()</code> (or elsewhere in a program’s lifecycle), or be written as part of <code>main()</code> itself. In particular, libraries that are intended to be used by other programs should take special care to be completely deterministic and not perform “init magic”.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb59"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Foo <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _defaultFoo Foo</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> init<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    _defaultFoo <span class="op">=</span> Foo<span class="op">{</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb60"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _defaultFoo <span class="op">=</span> Foo<span class="op">{</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">// or, better, for testability:</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _defaultFoo <span class="op">=</span> defaultFoo<span class="op">()</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> defaultFoo<span class="op">()</span> Foo <span class="op">{</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> Foo<span class="op">{</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<div class="sourceCode" id="cb61"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Config <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _config Config</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> init<span class="op">()</span> <span class="op">{</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bad: based on current directory</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    cwd<span class="op">,</span> _ <span class="op">:=</span> os<span class="op">.</span>Getwd<span class="op">()</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bad: I/O</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    raw<span class="op">,</span> _ <span class="op">:=</span> ioutil<span class="op">.</span>ReadFile<span class="op">(</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span>Join<span class="op">(</span>cwd<span class="op">,</span> <span class="st">&quot;config&quot;</span><span class="op">,</span> <span class="st">&quot;config.yaml&quot;</span><span class="op">),</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    yaml<span class="op">.</span>Unmarshal<span class="op">(</span>raw<span class="op">,</span> <span class="op">&amp;</span>_config<span class="op">)</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb62"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Config <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> loadConfig<span class="op">()</span> Config <span class="op">{</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    cwd<span class="op">,</span> err <span class="op">:=</span> os<span class="op">.</span>Getwd<span class="op">()</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle err</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    raw<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadFile<span class="op">(</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span>Join<span class="op">(</span>cwd<span class="op">,</span> <span class="st">&quot;config&quot;</span><span class="op">,</span> <span class="st">&quot;config.yaml&quot;</span><span class="op">),</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle err</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> config Config</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    yaml<span class="op">.</span>Unmarshal<span class="op">(</span>raw<span class="op">,</span> <span class="op">&amp;</span>config<span class="op">)</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> config</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Considering the above, some situations in which <code>init()</code> may be preferable or necessary might include:</p>
<ul>
<li>Complex expressions that cannot be represented as single assignments.</li>
<li>Pluggable hooks, such as <code>database/sql</code> dialects, encoding type registries, etc.</li>
<li>Optimizations to <a href="https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations">Google Cloud Functions</a> and other forms of deterministic precomputation.</li>
</ul>
<h3 id="exit-in-main">Exit in Main</h3>
<p>Go programs use <a href="https://golang.org/pkg/os/#Exit"><code>os.Exit</code></a> or <a href="https://golang.org/pkg/log/#Fatal"><code>log.Fatal*</code></a> to exit immediately. (Panicking is not a good way to exit programs, please <a href="#dont-panic">don’t panic</a>.)</p>
<p>Call one of <code>os.Exit</code> or <code>log.Fatal*</code> <strong>only in <code>main()</code></strong>. All other functions should return errors to signal failure.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb63"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  body <span class="op">:=</span> readFile<span class="op">(</span>path<span class="op">)</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  fmt<span class="op">.</span>Println<span class="op">(</span>body<span class="op">)</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> readFile<span class="op">(</span>path <span class="dt">string</span><span class="op">)</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  f<span class="op">,</span> err <span class="op">:=</span> os<span class="op">.</span>Open<span class="op">(</span>path<span class="op">)</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  b<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadAll<span class="op">(</span>f<span class="op">)</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="dt">string</span><span class="op">(</span>b<span class="op">)</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb64"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  body<span class="op">,</span> err <span class="op">:=</span> readFile<span class="op">(</span>path<span class="op">)</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  fmt<span class="op">.</span>Println<span class="op">(</span>body<span class="op">)</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> readFile<span class="op">(</span>path <span class="dt">string</span><span class="op">)</span> <span class="op">(</span><span class="dt">string</span><span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  f<span class="op">,</span> err <span class="op">:=</span> os<span class="op">.</span>Open<span class="op">(</span>path<span class="op">)</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="st">&quot;&quot;</span><span class="op">,</span> err</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  b<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadAll<span class="op">(</span>f<span class="op">)</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="st">&quot;&quot;</span><span class="op">,</span> err</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="dt">string</span><span class="op">(</span>b<span class="op">),</span> <span class="ot">nil</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Rationale: Programs with multiple functions that exit present a few issues:</p>
<ul>
<li>Non-obvious control flow: Any function can exit the program so it becomes difficult to reason about the control flow.</li>
<li>Difficult to test: A function that exits the program will also exit the test calling it. This makes the function difficult to test and introduces risk of skipping other tests that have not yet been run by <code>go test</code>.</li>
<li>Skipped cleanup: When a function exits the program, it skips function calls enqueued with <code>defer</code> statements. This adds risk of skipping important cleanup tasks.</li>
</ul>
<h4 id="exit-once">Exit Once</h4>
<p>If possible, prefer to call <code>os.Exit</code> or <code>log.Fatal</code> <strong>at most once</strong> in your <code>main()</code>. If there are multiple error scenarios that halt program execution, put that logic under a separate function and return errors from it.</p>
<p>This has the effect of shortening your <code>main()</code> function and putting all key business logic into a separate, testable function.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb65"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  args <span class="op">:=</span> os<span class="op">.</span>Args<span class="op">[</span><span class="dv">1</span><span class="op">:]</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="bu">len</span><span class="op">(</span>args<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span><span class="st">&quot;missing file&quot;</span><span class="op">)</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  name <span class="op">:=</span> args<span class="op">[</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  f<span class="op">,</span> err <span class="op">:=</span> os<span class="op">.</span>Open<span class="op">(</span>name<span class="op">)</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> f<span class="op">.</span>Close<span class="op">()</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If we call log.Fatal after this line,</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// f.Close will not be called.</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  b<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadAll<span class="op">(</span>f<span class="op">)</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb66"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> run<span class="op">();</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> run<span class="op">()</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  args <span class="op">:=</span> os<span class="op">.</span>Args<span class="op">[</span><span class="dv">1</span><span class="op">:]</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="bu">len</span><span class="op">(</span>args<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> errors<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;missing file&quot;</span><span class="op">)</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  name <span class="op">:=</span> args<span class="op">[</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  f<span class="op">,</span> err <span class="op">:=</span> os<span class="op">.</span>Open<span class="op">(</span>name<span class="op">)</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> err</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defer</span> f<span class="op">.</span>Close<span class="op">()</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  b<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadAll<span class="op">(</span>f<span class="op">)</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> err</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h2 id="performance">Performance</h2>
<p>Performance-specific guidelines apply only to the hot path.</p>
<h3 id="prefer-strconv-over-fmt">Prefer strconv over fmt</h3>
<p>When converting primitives to/from strings, <code>strconv</code> is faster than <code>fmt</code>.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb67"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> i<span class="op">++</span> <span class="op">{</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  s <span class="op">:=</span> fmt<span class="op">.</span>Sprint<span class="op">(</span>rand<span class="op">.</span>Int<span class="op">())</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb68"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> i<span class="op">++</span> <span class="op">{</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  s <span class="op">:=</span> strconv<span class="op">.</span>Itoa<span class="op">(</span>rand<span class="op">.</span>Int<span class="op">())</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<pre><code>BenchmarkFmtSprint-4    143 ns/op    2 allocs/op</code></pre>
</td>
<td>
<pre><code>BenchmarkStrconv-4    64.2 ns/op    1 allocs/op</code></pre>
</td>
</tr>
</tbody>
</table>
<h3 id="avoid-string-to-byte-conversion">Avoid string-to-byte conversion</h3>
<p>Do not create byte slices from a fixed string repeatedly. Instead, perform the conversion once and capture the result.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb71"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> i<span class="op">++</span> <span class="op">{</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  w<span class="op">.</span>Write<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span><span class="st">&quot;Hello world&quot;</span><span class="op">))</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb72"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">:=</span> <span class="op">[]</span><span class="dt">byte</span><span class="op">(</span><span class="st">&quot;Hello world&quot;</span><span class="op">)</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> i<span class="op">++</span> <span class="op">{</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  w<span class="op">.</span>Write<span class="op">(</span>data<span class="op">)</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</tr>
<tr>
<td>
<pre><code>BenchmarkBad-4   50000000   22.2 ns/op</code></pre>
</td>
<td>
<pre><code>BenchmarkGood-4  500000000   3.25 ns/op</code></pre>
</td>
</tr>
</tbody>
</table>
<h3 id="prefer-specifying-container-capacity">Prefer Specifying Container Capacity</h3>
<p>Specify container capacity where possible in order to allocate memory for the container up front. This minimizes subsequent allocations (by copying and resizing of the container) as elements are added.</p>
<h4 id="specifying-map-capacity-hints">Specifying Map Capacity Hints</h4>
<p>Where possible, provide capacity hints when initializing maps with <code>make()</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2<span class="op">,</span> hint<span class="op">)</span></span></code></pre></div>
<p>Providing a capacity hint to <code>make()</code> tries to right-size the map at initialization time, which reduces the need for growing the map and allocations as elements are added to the map.</p>
<p>Note that, unlike slices, map capacity hints do not guarantee complete, preemptive allocation, but are used to approximate the number of hashmap buckets required. Consequently, allocations may still occur when adding elements to the map, even up to the specified capacity.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb76"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span>os<span class="op">.</span>FileInfo<span class="op">)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>files<span class="op">,</span> _ <span class="op">:=</span> ioutil<span class="op">.</span>ReadDir<span class="op">(</span><span class="st">&quot;./files&quot;</span><span class="op">)</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> f <span class="op">:=</span> <span class="kw">range</span> files <span class="op">{</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    m<span class="op">[</span>f<span class="op">.</span>Name<span class="op">()]</span> <span class="op">=</span> f</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb77"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>files<span class="op">,</span> _ <span class="op">:=</span> ioutil<span class="op">.</span>ReadDir<span class="op">(</span><span class="st">&quot;./files&quot;</span><span class="op">)</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>m <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span>os<span class="op">.</span>FileInfo<span class="op">,</span> <span class="bu">len</span><span class="op">(</span>files<span class="op">))</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> f <span class="op">:=</span> <span class="kw">range</span> files <span class="op">{</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    m<span class="op">[</span>f<span class="op">.</span>Name<span class="op">()]</span> <span class="op">=</span> f</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<p><code>m</code> is created without a size hint; there may be more allocations at assignment time.</p>
</td>
<td>
<p><code>m</code> is created with a size hint; there may be fewer allocations at assignment time.</p>
</td>
</tr>
</tbody>
</table>
<h4 id="specifying-slice-capacity">Specifying Slice Capacity</h4>
<p>Where possible, provide capacity hints when initializing slices with <code>make()</code>, particularly when appending.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">make</span><span class="op">([]</span>T<span class="op">,</span> length<span class="op">,</span> capacity<span class="op">)</span></span></code></pre></div>
<p>Unlike maps, slice capacity is not a hint: the compiler will allocate enough memory for the capacity of the slice as provided to <code>make()</code>, which means that subsequent <code>append()</code> operations will incur zero allocations (until the length of the slice matches the capacity, after which any appends will require a resize to hold additional elements).</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb79"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> n <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> n <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> n<span class="op">++</span> <span class="op">{</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  data <span class="op">:=</span> <span class="bu">make</span><span class="op">([]</span><span class="dt">int</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> k <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> size<span class="op">;</span> k<span class="op">++{</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>data<span class="op">,</span> k<span class="op">)</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb80"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> n <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> n <span class="op">&lt;</span> b<span class="op">.</span>N<span class="op">;</span> n<span class="op">++</span> <span class="op">{</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  data <span class="op">:=</span> <span class="bu">make</span><span class="op">([]</span><span class="dt">int</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> size<span class="op">)</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> k <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> size<span class="op">;</span> k<span class="op">++{</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>data<span class="op">,</span> k<span class="op">)</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<pre><code>BenchmarkBad-4    100000000    2.48s</code></pre>
</td>
<td>
<pre><code>BenchmarkGood-4   100000000    0.21s</code></pre>
</td>
</tr>
</tbody>
</table>
<h2 id="style">Style</h2>
<h3 id="be-consistent">Be Consistent</h3>
<p>Some of the guidelines outlined in this document can be evaluated objectively; others are situational, contextual, or subjective.</p>
<p>Above all else, <strong>be consistent</strong>.</p>
<p>Consistent code is easier to maintain, is easier to rationalize, requires less cognitive overhead, and is easier to migrate or update as new conventions emerge or classes of bugs are fixed.</p>
<p>Conversely, having multiple disparate or conflicting styles within a single codebase causes maintenance overhead, uncertainty, and cognitive dissonance, all of which can directly contribute to lower velocity, painful code reviews, and bugs.</p>
<p>When applying these guidelines to a codebase, it is recommended that changes are made at a package (or larger) level: application at a sub-package level violates the above concern by introducing multiple styles into the same code.</p>
<h3 id="group-similar-declarations">Group Similar Declarations</h3>
<p>Go supports grouping similar declarations.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb83"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="st">&quot;b&quot;</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb84"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;a&quot;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;b&quot;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>This also applies to constants, variables, and type declarations.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb85"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> b <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> b <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Area <span class="dt">float64</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Volume <span class="dt">float64</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb86"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="op">(</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="op">(</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  Area <span class="dt">float64</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  Volume <span class="dt">float64</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Only group related declarations. Do not group declarations that are unrelated.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb87"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Operation <span class="dt">int</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  Add Operation <span class="op">=</span> <span class="ot">iota</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  Subtract</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  Multiply</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  EnvVar <span class="op">=</span> <span class="st">&quot;MY_ENV&quot;</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb88"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Operation <span class="dt">int</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  Add Operation <span class="op">=</span> <span class="ot">iota</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  Subtract</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  Multiply</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> EnvVar <span class="op">=</span> <span class="st">&quot;MY_ENV&quot;</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Groups are not limited in where they can be used. For example, you can use them inside of functions.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb89"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> f<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> red <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0xff0000</span><span class="op">)</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> green <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0x00ff00</span><span class="op">)</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> blue <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0x0000ff</span><span class="op">)</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb90"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> f<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> <span class="op">(</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    red   <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0xff0000</span><span class="op">)</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0x00ff00</span><span class="op">)</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    blue  <span class="op">=</span> color<span class="op">.</span>New<span class="op">(</span><span class="dv">0x0000ff</span><span class="op">)</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="import-group-ordering">Import Group Ordering</h3>
<p>There should be two import groups:</p>
<ul>
<li>Standard library</li>
<li>Everything else</li>
</ul>
<p>This is the grouping applied by goimports by default.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb91"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;fmt&quot;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;os&quot;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;go.uber.org/atomic&quot;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;golang.org/x/sync/errgroup&quot;</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb92"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;fmt&quot;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;os&quot;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;go.uber.org/atomic&quot;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;golang.org/x/sync/errgroup&quot;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="package-names">Package Names</h3>
<p>When naming packages, choose a name that is:</p>
<ul>
<li>All lower-case. No capitals or underscores.</li>
<li>Does not need to be renamed using named imports at most call sites.</li>
<li>Short and succinct. Remember that the name is identified in full at every call site.</li>
<li>Not plural. For example, <code>net/url</code>, not <code>net/urls</code>.</li>
<li>Not “common”, “util”, “shared”, or “lib”. These are bad, uninformative names.</li>
</ul>
<p>See also <a href="https://blog.golang.org/package-names">Package Names</a> and <a href="https://rakyll.org/style-packages/">Style guideline for Go packages</a>.</p>
<h3 id="function-names">Function Names</h3>
<p>We follow the Go community’s convention of using <a href="https://golang.org/doc/effective_go.html#mixed-caps">MixedCaps for function names</a>. An exception is made for test functions, which may contain underscores for the purpose of grouping related test cases, e.g., <code>TestMyFunction_WhatIsBeingTested</code>.</p>
<h3 id="import-aliasing">Import Aliasing</h3>
<p>Import aliasing must be used if the package name does not match the last element of the import path.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;net/http&quot;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  client <span class="st">&quot;example.com/client-go&quot;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  trace <span class="st">&quot;example.com/trace/v2&quot;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
<p>In all other scenarios, import aliases should be avoided unless there is a direct conflict between imports.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb94"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;fmt&quot;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;os&quot;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  nettrace <span class="st">&quot;golang.net/x/trace&quot;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb95"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;fmt&quot;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;os&quot;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;runtime/trace&quot;</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  nettrace <span class="st">&quot;golang.net/x/trace&quot;</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="function-grouping-and-ordering">Function Grouping and Ordering</h3>
<ul>
<li>Functions should be sorted in rough call order.</li>
<li>Functions in a file should be grouped by receiver.</li>
</ul>
<p>Therefore, exported functions should appear first in a file, after <code>struct</code>, <code>const</code>, <code>var</code> definitions.</p>
<p>A <code>newXYZ()</code>/<code>NewXYZ()</code> may appear after the type is defined, but before the rest of the methods on the receiver.</p>
<p>Since functions are grouped by receiver, plain utility functions should appear towards the end of the file.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb96"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>something<span class="op">)</span> Cost<span class="op">()</span> <span class="op">{</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> calcCost<span class="op">(</span>s<span class="op">.</span>weights<span class="op">)</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> something <span class="kw">struct</span><span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> calcCost<span class="op">(</span>n <span class="op">[]</span><span class="dt">int</span><span class="op">)</span> <span class="dt">int</span> <span class="op">{...}</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>something<span class="op">)</span> Stop<span class="op">()</span> <span class="op">{...}</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> newSomething<span class="op">()</span> <span class="op">*</span>something <span class="op">{</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">&amp;</span>something<span class="op">{}</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb97"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> something <span class="kw">struct</span><span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> newSomething<span class="op">()</span> <span class="op">*</span>something <span class="op">{</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">&amp;</span>something<span class="op">{}</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>something<span class="op">)</span> Cost<span class="op">()</span> <span class="op">{</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> calcCost<span class="op">(</span>s<span class="op">.</span>weights<span class="op">)</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>s <span class="op">*</span>something<span class="op">)</span> Stop<span class="op">()</span> <span class="op">{...}</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> calcCost<span class="op">(</span>n <span class="op">[]</span><span class="dt">int</span><span class="op">)</span> <span class="dt">int</span> <span class="op">{...}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="reduce-nesting">Reduce Nesting</h3>
<p>Code should reduce nesting where possible by handling error cases/special conditions first and returning early or continuing the loop. Reduce the amount of code that is nested multiple levels.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb98"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> v <span class="op">:=</span> <span class="kw">range</span> data <span class="op">{</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> v<span class="op">.</span>F1 <span class="op">==</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> process<span class="op">(</span>v<span class="op">)</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> err <span class="op">:=</span> v<span class="op">.</span>Call<span class="op">();</span> err <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>      v<span class="op">.</span>Send<span class="op">()</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">return</span> err</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Invalid v: %v&quot;</span><span class="op">,</span> v<span class="op">)</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb99"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> v <span class="op">:=</span> <span class="kw">range</span> data <span class="op">{</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> v<span class="op">.</span>F1 <span class="op">!=</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Invalid v: %v&quot;</span><span class="op">,</span> v<span class="op">)</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">continue</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  v <span class="op">=</span> process<span class="op">(</span>v<span class="op">)</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">:=</span> v<span class="op">.</span>Call<span class="op">();</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> err</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  v<span class="op">.</span>Send<span class="op">()</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="unnecessary-else">Unnecessary Else</h3>
<p>If a variable is set in both branches of an if, it can be replaced with a single if.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb100"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> a <span class="dt">int</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> b <span class="op">{</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb101"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">:=</span> <span class="dv">10</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> b <span class="op">{</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="top-level-variable-declarations">Top-level Variable Declarations</h3>
<p>At the top level, use the standard <code>var</code> keyword. Do not specify the type, unless it is not the same type as the expression.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb102"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _s <span class="dt">string</span> <span class="op">=</span> F<span class="op">()</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> F<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span> <span class="kw">return</span> <span class="st">&quot;A&quot;</span> <span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb103"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _s <span class="op">=</span> F<span class="op">()</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Since F already states that it returns a string, we don&#39;t need to specify</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">// the type again.</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> F<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span> <span class="kw">return</span> <span class="st">&quot;A&quot;</span> <span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Specify the type if the type of the expression does not match the desired type exactly.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> myError <span class="kw">struct</span><span class="op">{}</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>myError<span class="op">)</span> Error<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span> <span class="kw">return</span> <span class="st">&quot;error&quot;</span> <span class="op">}</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> F<span class="op">()</span> myError <span class="op">{</span> <span class="kw">return</span> myError<span class="op">{}</span> <span class="op">}</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> _e <span class="dt">error</span> <span class="op">=</span> F<span class="op">()</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="co">// F returns an object of type myError but we want error.</span></span></code></pre></div>
<h3 id="prefix-unexported-globals-with-_">Prefix Unexported Globals with _</h3>
<p>Prefix unexported top-level <code>var</code>s and <code>const</code>s with <code>_</code> to make it clear when they are used that they are global symbols.</p>
<p>Exception: Unexported error values, which should be prefixed with <code>err</code>.</p>
<p>Rationale: Top-level variables and constants have a package scope. Using a generic name makes it easy to accidentally use the wrong value in a different file.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb105"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">// foo.go</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  defaultPort <span class="op">=</span> <span class="dv">8080</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  defaultUser <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">// bar.go</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Bar<span class="op">()</span> <span class="op">{</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  defaultPort <span class="op">:=</span> <span class="dv">9090</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  fmt<span class="op">.</span>Println<span class="op">(</span><span class="st">&quot;Default port&quot;</span><span class="op">,</span> defaultPort<span class="op">)</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We will not see a compile error if the first line of</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bar() is deleted.</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb106"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">// foo.go</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  _defaultPort <span class="op">=</span> <span class="dv">8080</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  _defaultUser <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="embedding-in-structs">Embedding in Structs</h3>
<p>Embedded types (such as mutexes) should be at the top of the field list of a struct, and there must be an empty line separating embedded fields from regular fields.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb107"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Client <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  version <span class="dt">int</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  http<span class="op">.</span>Client</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb108"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Client <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  http<span class="op">.</span>Client</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  version <span class="dt">int</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Embedding should provide tangible benefit, like adding or augmenting functionality in a semantically-appropriate way. It should do this with zero adverse user-facing effects (see also: <a href="#avoid-embedding-types-in-public-structs">Avoid Embedding Types in Public Structs</a>).</p>
<p>Embedding <strong>should not</strong>:</p>
<ul>
<li>Be purely cosmetic or convenience-oriented.</li>
<li>Make outer types more difficult to construct or use.</li>
<li>Affect outer types’ zero values. If the outer type has a useful zero value, it should still have a useful zero value after embedding the inner type.</li>
<li>Expose unrelated functions or fields from the outer type as a side-effect of embedding the inner type.</li>
<li>Expose unexported types.</li>
<li>Affect outer types’ copy semantics.</li>
<li>Change the outer type’s API or type semantics.</li>
<li>Embed a non-canonical form of the inner type.</li>
<li>Expose implementation details of the outer type.</li>
<li>Allow users to observe or control type internals.</li>
<li>Change the general behavior of inner functions through wrapping in a way that would reasonably surprise users.</li>
</ul>
<p>Simply put, embed consciously and intentionally. A good litmus test is, “would all of these exported inner methods/fields be added directly to the outer type”; if the answer is “some” or “no”, don’t embed the inner type - use a field instead.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb109"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> A <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bad: A.Lock() and A.Unlock() are</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//      now available, provide no</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//      functional benefit, and allow</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//      users to control details about</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//      the internals of A.</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    sync<span class="op">.</span>Mutex</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb110"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> countingWriteCloser <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Good: Write() is provided at this</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//       outer layer for a specific</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//       purpose, and delegates work</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//       to the inner type&#39;s Write().</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    io<span class="op">.</span>WriteCloser</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    count <span class="dt">int</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>w <span class="op">*</span>countingWriteCloser<span class="op">)</span> Write<span class="op">(</span>bs <span class="op">[]</span><span class="dt">byte</span><span class="op">)</span> <span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    w<span class="op">.</span>count <span class="op">+=</span> <span class="bu">len</span><span class="op">(</span>bs<span class="op">)</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> w<span class="op">.</span>WriteCloser<span class="op">.</span>Write<span class="op">(</span>bs<span class="op">)</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<div class="sourceCode" id="cb111"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Book <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bad: pointer changes zero value usefulness</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    io<span class="op">.</span>ReadWriter</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// other fields</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co">// later</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> b Book</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>Read<span class="op">(...)</span>  <span class="co">// panic: nil pointer</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>String<span class="op">()</span>   <span class="co">// panic: nil pointer</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>Write<span class="op">(...)</span> <span class="co">// panic: nil pointer</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb112"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Book <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Good: has useful zero value</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    bytes<span class="op">.</span>Buffer</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// other fields</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co">// later</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> b Book</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>Read<span class="op">(...)</span>  <span class="co">// ok</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>String<span class="op">()</span>   <span class="co">// ok</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>Write<span class="op">(...)</span> <span class="co">// ok</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<div class="sourceCode" id="cb113"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Client <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    sync<span class="op">.</span>Mutex</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    sync<span class="op">.</span>WaitGroup</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    bytes<span class="op">.</span>Buffer</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    url<span class="op">.</span>URL</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb114"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Client <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    mtx sync<span class="op">.</span>Mutex</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    wg  sync<span class="op">.</span>WaitGroup</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    buf bytes<span class="op">.</span>Buffer</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    url url<span class="op">.</span>URL</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="local-variable-declarations">Local Variable Declarations</h3>
<p>Short variable declarations (<code>:=</code>) should be used if a variable is being set to some value explicitly.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb115"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> s <span class="op">=</span> <span class="st">&quot;foo&quot;</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb116"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">:=</span> <span class="st">&quot;foo&quot;</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>However, there are cases where the default value is clearer when the <code>var</code> keyword is used. <a href="https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices">Declaring Empty Slices</a>, for example.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb117"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> f<span class="op">(</span>list <span class="op">[]</span><span class="dt">int</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  filtered <span class="op">:=</span> <span class="op">[]</span><span class="dt">int</span><span class="op">{}</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> _<span class="op">,</span> v <span class="op">:=</span> <span class="kw">range</span> list <span class="op">{</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> v <span class="op">&gt;</span> <span class="dv">10</span> <span class="op">{</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>      filtered <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>filtered<span class="op">,</span> v<span class="op">)</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb118"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> f<span class="op">(</span>list <span class="op">[]</span><span class="dt">int</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> filtered <span class="op">[]</span><span class="dt">int</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> _<span class="op">,</span> v <span class="op">:=</span> <span class="kw">range</span> list <span class="op">{</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> v <span class="op">&gt;</span> <span class="dv">10</span> <span class="op">{</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>      filtered <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>filtered<span class="op">,</span> v<span class="op">)</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="nil-is-a-valid-slice">nil is a valid slice</h3>
<p><code>nil</code> is a valid slice of length 0. This means that,</p>
<ul>
<li><p>You should not return a slice of length zero explicitly. Return <code>nil</code> instead.</p>
<table>
<thead>
<tr>
<th>
<p>Bad</p>
</th>
<th>
<p>Good</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb119"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> x <span class="op">==</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="op">[]</span><span class="dt">int</span><span class="op">{}</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb120"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> x <span class="op">==</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="ot">nil</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table></li>
<li><p>To check if a slice is empty, always use <code>len(s) == 0</code>. Do not check for <code>nil</code>.</p>
<table>
<thead>
<tr>
<th>
<p>Bad</p>
</th>
<th>
<p>Good</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb121"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> isEmpty<span class="op">(</span>s <span class="op">[]</span><span class="dt">string</span><span class="op">)</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> s <span class="op">==</span> <span class="ot">nil</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb122"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> isEmpty<span class="op">(</span>s <span class="op">[]</span><span class="dt">string</span><span class="op">)</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="bu">len</span><span class="op">(</span>s<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table></li>
<li><p>The zero value (a slice declared with <code>var</code>) is usable immediately without <code>make()</code>.</p>
<table>
<thead>
<tr>
<th>
<p>Bad</p>
</th>
<th>
<p>Good</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb123"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>nums <span class="op">:=</span> <span class="op">[]</span><span class="dt">int</span><span class="op">{}</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co">// or, nums := make([]int)</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> add1 <span class="op">{</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  nums <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>nums<span class="op">,</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> add2 <span class="op">{</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>  nums <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>nums<span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb124"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nums <span class="op">[]</span><span class="dt">int</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> add1 <span class="op">{</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  nums <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>nums<span class="op">,</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> add2 <span class="op">{</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  nums <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>nums<span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Remember that, while it is a valid slice, a nil slice is not equivalent to an allocated slice of length 0 - one is nil and the other is not - and the two may be treated differently in different situations (such as serialization).</p>
<h3 id="reduce-scope-of-variables">Reduce Scope of Variables</h3>
<p>Where possible, reduce scope of variables. Do not reduce the scope if it conflicts with <a href="#reduce-nesting">Reduce Nesting</a>.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb125"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>err <span class="op">:=</span> ioutil<span class="op">.</span>WriteFile<span class="op">(</span>name<span class="op">,</span> data<span class="op">,</span> <span class="dv">0644</span><span class="op">)</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">return</span> err</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb126"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">:=</span> ioutil<span class="op">.</span>WriteFile<span class="op">(</span>name<span class="op">,</span> data<span class="op">,</span> <span class="dv">0644</span><span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">return</span> err</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>If you need a result of a function call outside of the if, then you should not try to reduce the scope.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb127"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> data<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadFile<span class="op">(</span>name<span class="op">);</span> err <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  err <span class="op">=</span> cfg<span class="op">.</span>Decode<span class="op">(</span>data<span class="op">)</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> err</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  fmt<span class="op">.</span>Println<span class="op">(</span>cfg<span class="op">)</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="ot">nil</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> err</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb128"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">,</span> err <span class="op">:=</span> ioutil<span class="op">.</span>ReadFile<span class="op">(</span>name<span class="op">)</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">return</span> err</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> err <span class="op">:=</span> cfg<span class="op">.</span>Decode<span class="op">(</span>data<span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> err</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>fmt<span class="op">.</span>Println<span class="op">(</span>cfg<span class="op">)</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span> <span class="ot">nil</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="avoid-naked-parameters">Avoid Naked Parameters</h3>
<p>Naked parameters in function calls can hurt readability. Add C-style comments (<code>/* ... */</code>) for parameter names when their meaning is not obvious.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb129"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func printInfo(name string, isLocal, done bool)</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>printInfo<span class="op">(</span><span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="ot">true</span><span class="op">,</span> <span class="ot">true</span><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb130"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func printInfo(name string, isLocal, done bool)</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>printInfo<span class="op">(</span><span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="ot">true</span> <span class="co">/* isLocal */</span><span class="op">,</span> <span class="ot">true</span> <span class="co">/* done */</span><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Better yet, replace naked <code>bool</code> types with custom types for more readable and type-safe code. This allows more than just two states (true/false) for that parameter in the future.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Region <span class="dt">int</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  UnknownRegion Region <span class="op">=</span> <span class="ot">iota</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  Local</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Status <span class="dt">int</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  StatusReady Status <span class="op">=</span> <span class="ot">iota</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  StatusDone</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Maybe we will have a StatusInProgress in the future.</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> printInfo<span class="op">(</span>name <span class="dt">string</span><span class="op">,</span> region Region<span class="op">,</span> status Status<span class="op">)</span></span></code></pre></div>
<h3 id="use-raw-string-literals-to-avoid-escaping">Use Raw String Literals to Avoid Escaping</h3>
<p>Go supports <a href="https://golang.org/ref/spec#raw_string_lit">raw string literals</a>, which can span multiple lines and include quotes. Use these to avoid hand-escaped strings which are much harder to read.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb132"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>wantError <span class="op">:=</span> <span class="st">&quot;unknown name:</span><span class="ch">\&quot;</span><span class="st">test</span><span class="ch">\&quot;</span><span class="st">&quot;</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb133"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>wantError <span class="op">:=</span> <span class="st">`unknown error:&quot;test&quot;`</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="initializing-structs">Initializing Structs</h3>
<h4 id="use-field-names-to-initialize-structs">Use Field Names to Initialize Structs</h4>
<p>You should almost always specify field names when initializing structs. This is now enforced by <a href="https://golang.org/cmd/vet/"><code>go vet</code></a>.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb134"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">:=</span> User<span class="op">{</span><span class="st">&quot;John&quot;</span><span class="op">,</span> <span class="st">&quot;Doe&quot;</span><span class="op">,</span> <span class="ot">true</span><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb135"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">:=</span> User<span class="op">{</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    FirstName<span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    LastName<span class="op">:</span> <span class="st">&quot;Doe&quot;</span><span class="op">,</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    Admin<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Exception: Field names <em>may</em> be omitted in test tables when there are 3 or fewer fields.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span><span class="op">{</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  op Operation</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  want <span class="dt">string</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="op">}{</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span>Add<span class="op">,</span> <span class="st">&quot;add&quot;</span><span class="op">},</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span>Subtract<span class="op">,</span> <span class="st">&quot;subtract&quot;</span><span class="op">},</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="omit-zero-value-fields-in-structs">Omit Zero Value Fields in Structs</h4>
<p>When initializing structs with field names, omit fields that have zero values unless they provide meaningful context. Otherwise, let Go set these to zero values automatically.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb137"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>user <span class="op">:=</span> User<span class="op">{</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  FirstName<span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  LastName<span class="op">:</span> <span class="st">&quot;Doe&quot;</span><span class="op">,</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  MiddleName<span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  Admin<span class="op">:</span> <span class="ot">false</span><span class="op">,</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb138"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>user <span class="op">:=</span> User<span class="op">{</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  FirstName<span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  LastName<span class="op">:</span> <span class="st">&quot;Doe&quot;</span><span class="op">,</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>This helps reduce noise for readers by omitting values that are default in that context. Only meaningful values are specified.</p>
<p>Include zero values where field names provide meaningful context. For example, test cases in <a href="#test-tables">Test Tables</a> can benefit from names of fields even when they are zero-valued.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span><span class="op">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  give <span class="dt">string</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  want <span class="dt">int</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="op">}{</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span>give<span class="op">:</span> <span class="st">&quot;0&quot;</span><span class="op">,</span> want<span class="op">:</span> <span class="dv">0</span><span class="op">},</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="use-var-for-zero-value-structs">Use <code>var</code> for Zero Value Structs</h4>
<p>When all the fields of a struct are omitted in a declaration, use the <code>var</code> form to declare the struct.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb140"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>user <span class="op">:=</span> User<span class="op">{}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb141"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> user User</span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>This differentiates zero valued structs from those with non-zero fields similar to the distinction created for <a href="#initializing-maps">map initialization</a>, and matches how we prefer to <a href="https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices">declare empty slices</a>.</p>
<h4 id="initializing-struct-references">Initializing Struct References</h4>
<p>Use <code>&amp;T{}</code> instead of <code>new(T)</code> when initializing struct references so that it is consistent with the struct initialization.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb142"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>sval <span class="op">:=</span> T<span class="op">{</span>Name<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">}</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co">// inconsistent</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>sptr <span class="op">:=</span> <span class="bu">new</span><span class="op">(</span>T<span class="op">)</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>sptr<span class="op">.</span>Name <span class="op">=</span> <span class="st">&quot;bar&quot;</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb143"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>sval <span class="op">:=</span> T<span class="op">{</span>Name<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">}</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>sptr <span class="op">:=</span> <span class="op">&amp;</span>T<span class="op">{</span>Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="initializing-maps">Initializing Maps</h3>
<p>Prefer <code>make(..)</code> for empty maps, and maps populated programmatically. This makes map initialization visually distinct from declaration, and it makes it easy to add size hints later if available.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb144"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="op">(</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// m1 is safe to read and write;</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// m2 will panic on writes.</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  m1 <span class="op">=</span> <span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2<span class="op">{}</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  m2 <span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb145"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="op">(</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// m1 is safe to read and write;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// m2 will panic on writes.</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  m1 <span class="op">=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2<span class="op">)</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  m2 <span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<p>Declaration and initialization are visually similar.</p>
</td>
<td>
<p>Declaration and initialization are visually distinct.</p>
</td>
</tr>
</tbody>
</table>
<p>Where possible, provide capacity hints when initializing maps with <code>make()</code>. See <a href="#specifying-map-capacity-hints">Specifying Map Capacity Hints</a> for more information.</p>
<p>On the other hand, if the map holds a fixed list of elements, use map literals to initialize the map.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb146"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span><span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2<span class="op">,</span> <span class="dv">3</span><span class="op">)</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>m<span class="op">[</span>k1<span class="op">]</span> <span class="op">=</span> v1</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>m<span class="op">[</span>k2<span class="op">]</span> <span class="op">=</span> v2</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>m<span class="op">[</span>k3<span class="op">]</span> <span class="op">=</span> v3</span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb147"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span>T1<span class="op">]</span>T2<span class="op">{</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  k1<span class="op">:</span> v1<span class="op">,</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  k2<span class="op">:</span> v2<span class="op">,</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  k3<span class="op">:</span> v3<span class="op">,</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>The basic rule of thumb is to use map literals when adding a fixed set of elements at initialization time, otherwise use <code>make</code> (and specify a size hint if available).</p>
<h3 id="format-strings-outside-printf">Format Strings outside Printf</h3>
<p>If you declare format strings for <code>Printf</code>-style functions outside a string literal, make them <code>const</code> values.</p>
<p>This helps <code>go vet</code> perform static analysis of the format string.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb148"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>msg <span class="op">:=</span> <span class="st">&quot;unexpected values %v, %v</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>fmt<span class="op">.</span>Printf<span class="op">(</span>msg<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb149"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> msg <span class="op">=</span> <span class="st">&quot;unexpected values %v, %v</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>fmt<span class="op">.</span>Printf<span class="op">(</span>msg<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<h3 id="naming-printf-style-functions">Naming Printf-style Functions</h3>
<p>When you declare a <code>Printf</code>-style function, make sure that <code>go vet</code> can detect it and check the format string.</p>
<p>This means that you should use predefined <code>Printf</code>-style function names if possible. <code>go vet</code> will check these by default. See <a href="https://golang.org/cmd/vet/#hdr-Printf_family">Printf family</a> for more information.</p>
<p>If using the predefined names is not an option, end the name you choose with f: <code>Wrapf</code>, not <code>Wrap</code>. <code>go vet</code> can be asked to check specific <code>Printf</code>-style names but they must end with f.</p>
<pre class="shell"><code>$ go vet -printfuncs=wrapf,statusf</code></pre>
<p>See also <a href="https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/">go vet: Printf family check</a>.</p>
<h2 id="patterns">Patterns</h2>
<h3 id="test-tables">Test Tables</h3>
<p>Use table-driven tests with <a href="https://blog.golang.org/subtests">subtests</a> to avoid duplicating code when the core test logic is repetitive.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb151"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func TestSplitHostPort(t *testing.T)</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>host<span class="op">,</span> port<span class="op">,</span> err <span class="op">:=</span> net<span class="op">.</span>SplitHostPort<span class="op">(</span><span class="st">&quot;192.0.2.0:8000&quot;</span><span class="op">)</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;192.0.2.0&quot;</span><span class="op">,</span> host<span class="op">)</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span> port<span class="op">)</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>host<span class="op">,</span> port<span class="op">,</span> err <span class="op">=</span> net<span class="op">.</span>SplitHostPort<span class="op">(</span><span class="st">&quot;192.0.2.0:http&quot;</span><span class="op">)</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;192.0.2.0&quot;</span><span class="op">,</span> host<span class="op">)</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;http&quot;</span><span class="op">,</span> port<span class="op">)</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>host<span class="op">,</span> port<span class="op">,</span> err <span class="op">=</span> net<span class="op">.</span>SplitHostPort<span class="op">(</span><span class="st">&quot;:8000&quot;</span><span class="op">)</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">,</span> host<span class="op">)</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span> port<span class="op">)</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>host<span class="op">,</span> port<span class="op">,</span> err <span class="op">=</span> net<span class="op">.</span>SplitHostPort<span class="op">(</span><span class="st">&quot;1:8&quot;</span><span class="op">)</span></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">,</span> host<span class="op">)</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;8&quot;</span><span class="op">,</span> port<span class="op">)</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb152"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">// func TestSplitHostPort(t *testing.T)</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span><span class="op">{</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  give     <span class="dt">string</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  wantHost <span class="dt">string</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  wantPort <span class="dt">string</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="op">}{</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    give<span class="op">:</span>     <span class="st">&quot;192.0.2.0:8000&quot;</span><span class="op">,</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    wantHost<span class="op">:</span> <span class="st">&quot;192.0.2.0&quot;</span><span class="op">,</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    wantPort<span class="op">:</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>    give<span class="op">:</span>     <span class="st">&quot;192.0.2.0:http&quot;</span><span class="op">,</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>    wantHost<span class="op">:</span> <span class="st">&quot;192.0.2.0&quot;</span><span class="op">,</span></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>    wantPort<span class="op">:</span> <span class="st">&quot;http&quot;</span><span class="op">,</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>    give<span class="op">:</span>     <span class="st">&quot;:8000&quot;</span><span class="op">,</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>    wantHost<span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>    wantPort<span class="op">:</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>    give<span class="op">:</span>     <span class="st">&quot;1:8&quot;</span><span class="op">,</span></span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>    wantHost<span class="op">:</span> <span class="st">&quot;1&quot;</span><span class="op">,</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a>    wantPort<span class="op">:</span> <span class="st">&quot;8&quot;</span><span class="op">,</span></span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> tt <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>  t<span class="op">.</span>Run<span class="op">(</span>tt<span class="op">.</span>give<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a>    host<span class="op">,</span> port<span class="op">,</span> err <span class="op">:=</span> net<span class="op">.</span>SplitHostPort<span class="op">(</span>tt<span class="op">.</span>give<span class="op">)</span></span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a>    require<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb152-34"><a href="#cb152-34" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> tt<span class="op">.</span>wantHost<span class="op">,</span> host<span class="op">)</span></span>
<span id="cb152-35"><a href="#cb152-35" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> tt<span class="op">.</span>wantPort<span class="op">,</span> port<span class="op">)</span></span>
<span id="cb152-36"><a href="#cb152-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">})</span></span>
<span id="cb152-37"><a href="#cb152-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Test tables make it easier to add context to error messages, reduce duplicate logic, and add new test cases.</p>
<p>We follow the convention that the slice of structs is referred to as <code>tests</code> and each test case <code>tt</code>. Further, we encourage explicating the input and output values for each test case with <code>give</code> and <code>want</code> prefixes.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span><span class="op">{</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  give     <span class="dt">string</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  wantHost <span class="dt">string</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  wantPort <span class="dt">string</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="op">}{</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> _<span class="op">,</span> tt <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="functional-options">Functional Options</h3>
<p>Functional options is a pattern in which you declare an opaque <code>Option</code> type that records information in some internal struct. You accept a variadic number of these options and act upon the full information recorded by the options on the internal struct.</p>
<p>Use this pattern for optional arguments in constructors and other public APIs that you foresee needing to expand, especially if you already have three or more arguments on those functions.</p>
<table>
<thead>
<tr>
<th>
Bad
</th>
<th>
Good
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<div class="sourceCode" id="cb154"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">// package db</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">(</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  addr <span class="dt">string</span><span class="op">,</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  cache <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  logger <span class="op">*</span>zap<span class="op">.</span>Logger</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">(*</span>Connection<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
<td>
<div class="sourceCode" id="cb155"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">// package db</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Option <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> WithCache<span class="op">(</span>c <span class="dt">bool</span><span class="op">)</span> Option <span class="op">{</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> WithLogger<span class="op">(</span>log <span class="op">*</span>zap<span class="op">.</span>Logger<span class="op">)</span> Option <span class="op">{</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Open creates a connection.</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">(</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>  addr <span class="dt">string</span><span class="op">,</span></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>  opts <span class="op">...</span>Option<span class="op">,</span></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">(*</span>Connection<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>
<p>The cache and logger parameters must always be provided, even if the user wants to use the default.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> db<span class="op">.</span>DefaultCache<span class="op">,</span> zap<span class="op">.</span>NewNop<span class="op">())</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> db<span class="op">.</span>DefaultCache<span class="op">,</span> log<span class="op">)</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> <span class="ot">false</span> <span class="co">/* cache */</span><span class="op">,</span> zap<span class="op">.</span>NewNop<span class="op">())</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> <span class="ot">false</span> <span class="co">/* cache */</span><span class="op">,</span> log<span class="op">)</span></span></code></pre></div>
</td>
<td>
<p>Options are provided only if needed.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">)</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> db<span class="op">.</span>WithLogger<span class="op">(</span>log<span class="op">))</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span>addr<span class="op">,</span> db<span class="op">.</span>WithCache<span class="op">(</span><span class="ot">false</span><span class="op">))</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span>Open<span class="op">(</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  addr<span class="op">,</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  db<span class="op">.</span>WithCache<span class="op">(</span><span class="ot">false</span><span class="op">),</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  db<span class="op">.</span>WithLogger<span class="op">(</span>log<span class="op">),</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
</td>
</tr>
</tbody>
</table>
<p>Our suggested way of implementing this pattern is with an <code>Option</code> interface that holds an unexported method, recording options on an unexported <code>options</code> struct.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> options <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  cache  <span class="dt">bool</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  logger <span class="op">*</span>zap<span class="op">.</span>Logger</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Option <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  apply<span class="op">(*</span>options<span class="op">)</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> cacheOption <span class="dt">bool</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>c cacheOption<span class="op">)</span> apply<span class="op">(</span>opts <span class="op">*</span>options<span class="op">)</span> <span class="op">{</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  opts<span class="op">.</span>cache <span class="op">=</span> <span class="dt">bool</span><span class="op">(</span>c<span class="op">)</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> WithCache<span class="op">(</span>c <span class="dt">bool</span><span class="op">)</span> Option <span class="op">{</span></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> cacheOption<span class="op">(</span>c<span class="op">)</span></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> loggerOption <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>  Log <span class="op">*</span>zap<span class="op">.</span>Logger</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>l loggerOption<span class="op">)</span> apply<span class="op">(</span>opts <span class="op">*</span>options<span class="op">)</span> <span class="op">{</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>  opts<span class="op">.</span>logger <span class="op">=</span> l<span class="op">.</span>Log</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> WithLogger<span class="op">(</span>log <span class="op">*</span>zap<span class="op">.</span>Logger<span class="op">)</span> Option <span class="op">{</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> loggerOption<span class="op">{</span>Log<span class="op">:</span> log<span class="op">}</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Open creates a connection.</span></span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Open<span class="op">(</span></span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a>  addr <span class="dt">string</span><span class="op">,</span></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a>  opts <span class="op">...</span>Option<span class="op">,</span></span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">(*</span>Connection<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>  options <span class="op">:=</span> options<span class="op">{</span></span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>    cache<span class="op">:</span>  defaultCache<span class="op">,</span></span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">:</span> zap<span class="op">.</span>NewNop<span class="op">(),</span></span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> _<span class="op">,</span> o <span class="op">:=</span> <span class="kw">range</span> opts <span class="op">{</span></span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span>apply<span class="op">(&amp;</span>options<span class="op">)</span></span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Note that there’s a method of implementing this pattern with closures but we believe that the pattern above provides more flexibility for authors and is easier to debug and test for users. In particular, it allows options to be compared against each other in tests and mocks, versus closures where this is impossible. Further, it lets options implement other interfaces, including <code>fmt.Stringer</code> which allows for user-readable string representations of the options.</p>
<p>See also,</p>
<ul>
<li><a href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html">Self-referential functions and the design of options</a></li>
<li><a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis">Functional options for friendly APIs</a></li>
</ul>
<!-- TODO: replace this with parameter structs and functional options, when to
use one vs other -->
<h2 id="linting">Linting</h2>
<p>More importantly than any “blessed” set of linters, lint consistently across a codebase.</p>
<p>We recommend using the following linters at a minimum, because we feel that they help to catch the most common issues and also establish a high bar for code quality without being unnecessarily prescriptive:</p>
<ul>
<li><a href="https://github.com/kisielk/errcheck">errcheck</a> to ensure that errors are handled</li>
<li><a href="https://godoc.org/golang.org/x/tools/cmd/goimports">goimports</a> to format code and manage imports</li>
<li><a href="https://github.com/golang/lint">golint</a> to point out common style mistakes</li>
<li><a href="https://golang.org/cmd/vet/">govet</a> to analyze code for common mistakes</li>
<li><a href="https://staticcheck.io/">staticcheck</a> to do various static analysis checks</li>
</ul>
<h3 id="lint-runners">Lint Runners</h3>
<p>We recommend <a href="https://github.com/golangci/golangci-lint">golangci-lint</a> as the go-to lint runner for Go code, largely due to its performance in larger codebases and ability to configure and use many canonical linters at once. This repo has an example <a href="https://github.com/uber-go/guide/blob/master/.golangci.yml">.golangci.yml</a> config file with recommended linters and settings.</p>
<p>golangci-lint has <a href="https://golangci-lint.run/usage/linters/">various linters</a> available for use. The above linters are recommended as a base set, and we encourage teams to add any additional linters that make sense for their projects.</p>
</body>
</html>
